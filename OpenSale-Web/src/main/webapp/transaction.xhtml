<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <body>

        <ui:composition template="./OpenSaleTemplate.xhtml">

            <ui:define name="PageTitle">
                Checkout
            </ui:define>

            <ui:define name="navBar">
                <div class="brand">Checkout</div>
            </ui:define>

            <ui:define name="content">

                <div id="userList"> 

                    <p:outputPanel autoUpdate="true">
                        <h:form>                        
                            <p:dataTable value="#{transactionBean.currentTransaction.items}"
                                         var="rowuser"
                                         rowStyleClass="#{rowuser.isVoided ? 'voided' : null}"
                                         editable="true" editMode="cell"
                                         widgetVar="transactionTable">                                                        

                                <p:column headerText="Item Name">                                
                                    <h:outputText value="#{rowuser.product.productName}"/>
                                </p:column>

                                <p:column headerText="Price">                                
                                    <h:outputText value="#{rowuser.product.price}">
                                        <f:convertNumber type="currency"/>
                                    </h:outputText>
                                </p:column>

                                <p:column headerText="Quantity">
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{rowuser.quantity}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{rowuser.quantity}">
                                                <f:validateLongRange minimum="1"/>
                                            </p:inputText>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>

                                <p:column headerText="Purchased Weight">
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{rowuser.purchasedWeight}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText value="#{rowuser.purchasedWeight}">
                                                <f:validateDoubleRange minimum="0.0"/>
                                            </p:inputText>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>

                                <p:column>                                
                                    <p:commandButton action="#{transactionBean.voidItem(rowuser)}"
                                                     value="Void"
                                                     styleClass="btn-danger"                                                     
                                                     rendered="#{rowuser.isVoided == false}"/>
                                    <p:commandButton action="#{transactionBean.unvoidItem(rowuser)}"                                                     
                                                     value="Unvoid"                                                     
                                                     rendered="#{rowuser.isVoided}"/>                                    
                                </p:column>

                                <f:facet name="footer">
                                    Your total is 
                                    <h:outputText value="#{transactionBean.currentTransaction.generateTotal()}"
                                                  id="total"> 
                                        <f:convertNumber type="currency"/>
                                    </h:outputText>                                
                                </f:facet>

                            </p:dataTable>
                        </h:form>
                    </p:outputPanel> 
                    <br/>

                    <p:dialog header="Discount" widgetVar="discountDlg">

                        <h:form id="Discount">

                            <h:panelGrid columns="2" cellpadding="5">
                                <h:outputLabel for="percentInput" value="Percentage Off: " />
                                <p:inputText id="percentInput" required="false"
                                           value="#{transactionBean.discountPercent}"> 
                                    <f:convertNumber type="percent"/> 
                                    <f:validateDoubleRange minimum="0" maximum="100"/>
                                </p:inputText>

                                <h:outputLabel for="dollarInput" value="Amount Off: " />
                                <p:inputText id="dollarInput" required="false" 
                                           value="#{transactionBean.discountAmount}">
                                    <f:convertNumber type="currency"/>
                                    <f:validateDoubleRange minimum="0"/>
                                </p:inputText>

                                <f:facet name="footer">
                                    <h:commandButton value="Submit" class="btn btn-primary"                                                     
                                                     action="#{transactionBean.addDiscount()}"/>
                                    <button class="btn" type="Reset">Clear</button>
                                    <button class="btn" type="Cancel">Cancel</button>
                                </f:facet>
                            </h:panelGrid>
                        </h:form>

                    </p:dialog>


                    <p:dialog header="Coupon" widgetVar="couponDlg">

                        <h:form id="Coupon">

                            <h:panelGrid columns="2" cellpadding="5">
                                <h:outputLabel for="couponInput" value="Coupon UPC: " />
                                <p:inputText mask="9-999-999-999-9" value="#{transactionBean.newItemUPC}"/>

                                <f:facet name="footer">
                                    <h:commandButton value="Submit" class="btn btn-primary"
                                                     />
                                    <button class="btn" type="Reset">Clear</button>
                                    <button class="btn" type="Cancel">Cancel</button>
                                </f:facet>
                            </h:panelGrid>

                        </h:form>

                    </p:dialog>

                    <p:button style="margin-bottom: 10px" onclick="$('#addByNameForm').toggle();
                            $('#addByUPCForm').hide();
                            return false;" value="Add Item By Name"/>
                    <p:button style="margin-bottom: 10px" onclick="$('#addByUPCForm').toggle();
                            $('#addByNameForm').hide();
                            return false;" value="Add Item By UPC"/>                   

                    <h:form id="addByNameForm" class="form-inline" style="display:none;">
                        <p:selectOneMenu value="#{transactionBean.newItemUPC}"
                                         filter="true" filterMatchMode="contains"
                                         style="margin-right: 5px">
                            <f:selectItems value="#{catalogManagementBean.productList}"
                                           var="product"
                                           itemValue="#{product.UPC}"
                                           itemLabel="#{product.productName}"/>                        

                        </p:selectOneMenu>
                        <p:outputLabel for="newItemQuantity" value="Quantity: "/>
                        <p:inputText  required="false"
                                      id="newItemQuantity"
                                      label="Quantity"   
                                      style="width: 10%"
                                      value="#{transactionBean.newItemQuantity}"
                                      >
                            <f:validateLongRange minimum="1"/>
                        </p:inputText>

                        <p:outputLabel style="margin-left: 5px" for="newItemWeight" value="Weight: "/>
                        <p:inputText  required="false" 
                                      id="newItemWeight"
                                      label="Weight"
                                      style="width: 10%"
                                      value="#{transactionBean.newItemWeight}"/>                           

                        <h:commandButton action="#{transactionBean.addItem()}"
                                         value="Add"
                                         style="margin-left: 5px"
                                         class="btn">                                                                       
                        </h:commandButton>                            
                    </h:form>                                        

                    <h:form id="addByUPCForm" class="form-inline" style="display:none">
                        <h:outputText value="UPC: "/>
                        <p:inputText  required="true" 
                                      label="UPC"
                                      style="width: 10%"                                              
                                      value="#{transactionBean.newItemUPC}" />

                        <h:outputText style="margin-left: 5px" value="Item Quantity: "/>
                        <p:inputText  required="true"
                                      label="quantity"   
                                      style="width: 10%"
                                      value="#{transactionBean.newItemQuantity}">
                            <f:validateLongRange minimum="1"/>
                        </p:inputText>

                        <h:outputText style="margin-left: 5px" value="Item Weight: "/>
                        <p:inputText  required="false" 
                                      label="weight"   
                                      style="width: 10%"
                                      value="#{transactionBean.newItemWeight}"/>


                        <h:commandButton action="#{transactionBean.addItem()}"
                                         value="Add"
                                         style="margin-left: 5px"
                                         class="btn"/>        



                    </h:form>   
                    <h:form style="margin: 1em" rendered="#{loginBean.currentUserIsManager()
                                                            || loginBean.currentUserIsAdmin()
                                                            || loginBean.currentUserIsSuperUser()}"
                                                            >
                        <h:commandButton type="button"
                                         value="Discount" class="btn"
                                         onclick="discountDlg.show()"/>
                        <h:commandButton type="button"
                                         value="Coupon" class="btn"
                                         onclick="couponDlg.show()"/>
                    </h:form>
                    <p:separator/>
                    <h:form>
                        <p:commandButton action="checkout"
                                         value="Checkout" styleClass="btn-success"/> 
                        
                    </h:form>
                </div>
            </ui:define>
        </ui:composition>        
    </body>
</html>
