<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <body>

        <ui:composition template="./OpenSaleTemplate.xhtml">

            <ui:define name="PageTitle">
                Transaction
            </ui:define>

            <ui:define name="navBar">
                <div class="brand">Transaction</div>
            </ui:define>

            <ui:define name="content">

                <div id="userList" class="span8 offset2"> 

                    <h:form>                        
                        <p:dataTable value="#{transactionBean.currentTransaction.items}"
                                     var="rowuser"
                                     rowStyleClass="#{rowuser.isVoided ? 'voided' : null}"
                                     editable="true" editMode="cell"
                                     widgetVar="transactionTable">
                            
                            <p:ajax event="cellEdit" update="total"/>
                            
                            <p:column headerText="Item Name">                                
                                <h:outputText value="#{rowuser.product.productName}"/>
                            </p:column>

                            <p:column headerText="Price">                                
                                <h:outputText value="#{rowuser.product.price}">
                                    <f:convertNumber type="currency"/>
                                </h:outputText>
                            </p:column>

                            <p:column headerText="Quantity">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{rowuser.quantity}"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputText value="#{rowuser.quantity}">
                                            <f:validateLongRange minimum="1"/>
                                        </p:inputText>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>

                            <p:column headerText="Purchased Weight">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{rowuser.purchasedWeight}"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputText value="#{rowuser.purchasedWeight}">
                                            <f:validateDoubleRange minimum="0.0"/>
                                        </p:inputText>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>

                            <p:column>                                
                                <h:commandButton action="#{transactionBean.unvoidItem(rowuser.product.UPC)}"
                                                 value="Unvoid"
                                                 class="btn"
                                                 rendered="#{rowuser.isVoided}"/>
                                <h:commandButton action="#{transactionBean.voidItem(rowuser.product.UPC)}"
                                                 value="Void"
                                                 class="btn btn-danger"
                                                 rendered="#{!(rowuser.isVoided)}"/>
                            </p:column>
                            
                            <f:facet name="footer">
                                Your total is 
                                <h:outputText value="#{transactionBean.currentTransaction.generateTotal()}"
                                              id="total">
                                    <f:convertNumber type="currency"/>
                                </h:outputText>
                            </f:facet>

                        </p:dataTable>
                    </h:form>
                    <br/>
                    <p:commandButton id="showAddByNameButton" value="Add Item By Name">  
                        <f:setPropertyActionListener value="#{true}" target="#{requestScope.showAddByNamePanel}" />  
                    </p:commandButton>                      

                    <p:commandButton id="showButton" value="Add Item By UPC">  
                        <f:setPropertyActionListener value="#{true}" target="#{requestScope.renderCampNou}" />  
                    </p:commandButton>  

                    <p:outputPanel id="addByNamePanel" autoUpdate="true">  
                        <h:form rendered="#{requestScope.showAddByNamePanel}"
                                class="form-inline">
                            <p:selectOneMenu value="#{transactionBean.newItemUPC}"
                                             filter="true" filterMatchMode="contains">
                                <f:selectItems value="#{catalogManagementBean.productList}"
                                               var="product"
                                               itemValue="#{product.UPC}"
                                               itemLabel="#{product.productName}"/>                        

                            </p:selectOneMenu>
                            <p:outputLabel for="newItemQuantity" value="Quantity: "/>
                            <p:inputText  required="false"
                                          id="newItemQuantity"
                                          label="Quantity"   
                                          style="width: 10%"
                                          value="#{transactionBean.newItemQuantity}"
                                          >
                                <f:validateLongRange minimum="1"/>
                            </p:inputText>

                            <p:outputLabel for="newItemWeight" value="Weight: "/>
                            <p:inputText  required="false" 
                                          id="newItemWeight"
                                          label="Weight"
                                          style="width: 10%"
                                          value="#{transactionBean.newItemWeight}"/>                           

                            <h:commandButton action="#{transactionBean.addItem()}"
                                             value="Add"
                                             class="btn">                                                                       
                            </h:commandButton>                            
                        </h:form>
                    </p:outputPanel>

                    <p:outputPanel id="panel" autoUpdate="true">  
                        <br/>

                        <h:form  rendered="#{requestScope.renderCampNou}" 
                                 class="form-inline">

                            <h:outputText value="UPC: "/>
                            <p:inputText  required="true" 
                                          label="UPC"
                                          style="width: 10%"                                              
                                          value="#{transactionBean.newItemUPC}" />

                            <h:outputText value="Item Quantity: "/>
                            <p:inputText  required="true"
                                          label="quantity"   
                                          style="width: 10%"
                                          value="#{transactionBean.newItemQuantity}"/>

                            <h:outputText value="Item Weight: "/>
                            <p:inputText  required="false" 
                                          label="weight"   
                                          style="width: 10%"
                                          value="#{transactionBean.newItemWeight}"/>


                            <h:commandButton action="#{transactionBean.addItem()}"
                                             value="Add"                                                 
                                             class="btn"/>                                 

                        </h:form>
                    </p:outputPanel>  
                </div>
            </ui:define>
        </ui:composition>

    </body>
</html>
